#pragma once
#include <GL/glut.h>
#include "grid.h"
#include <stdlib.h>
#include <vector>
#include <utility>

using namespace std;

class Surface{
    public:
    Surface();
    ~Surface();
    void load_dimensions(int x,int y, int z);
    void load_surface_data(char *file);
    unsigned char get_index(double *vertValues);
    void marching_cube();
    void generate_triangles(Cube cube);


    Point interpolate(Point p1, Point p2,double v1, double v2);
    std::pair<int,int> edgeToVertex(int edgeList);

    void render_surface();    

    double*** points;

    int width,height,depth;
    std::vector<Triangle> triangles;
    private:

    int edgeTable[256] = {
        0, 265, 515, 778, 1030, 1295, 1541, 1804, 2060, 2309, 2575, 2822, 3082, 3331, 3593, 3840, 400, 
        153, 915, 666, 1430, 1183, 1941, 1692, 2460, 2197, 2975, 2710, 3482, 3219, 3993, 3728, 560, 
        825, 51, 314, 1590, 1855, 1077, 1340, 2620, 2869, 2111, 2358, 3642, 3891, 3129, 3376, 928, 
        681, 419, 170, 1958, 1711, 1445, 1196, 2988, 2725, 2479, 2214, 4010, 3747, 3497, 3232, 1120, 
        1385, 1635, 1898, 102, 367, 613, 876, 3180, 3429, 3695, 3942, 2154, 2403, 2665, 2912, 1520, 
        1273, 2035, 1786, 502, 255, 1013, 764, 3580, 3317, 4095, 3830, 2554, 2291, 3065, 2800, 1616, 
        1881, 1107, 1370, 598, 863, 85, 348, 3676, 3925, 3167, 3414, 2650, 2899, 2137, 2384, 1984, 
        1737, 1475, 1226, 966, 719, 453, 204, 4044, 3781, 3535, 3270, 3018, 2755, 2505, 2240, 2240, 
        2505, 2755, 3018, 3270, 3535, 3781, 4044, 204, 453, 719, 966, 1226, 1475, 1737, 1984, 2384, 
        2137, 2899, 2650, 3414, 3167, 3925, 3676, 348, 85, 863, 598, 1370, 1107, 1881, 1616, 2800, 
        3065, 2291, 2554, 3830, 4095, 3317, 3580, 764, 1013, 255, 502, 1786, 2035, 1273, 1520, 2912, 
        2665, 2403, 2154, 3942, 3695, 3429, 3180, 876, 613, 367, 102, 1898, 1635, 1385, 1120, 3232, 
        3497, 3747, 4010, 2214, 2479, 2725, 2988, 1196, 1445, 1711, 1958, 170, 419, 681, 928, 3376, 
        3129, 3891, 3642, 2358, 2111, 2869, 2620, 1340, 1077, 1855, 1590, 314, 51, 825, 560, 3728, 
        3993, 3219, 3482, 2710, 2975, 2197, 2460, 1692, 1941, 1183, 1430, 666, 915, 153, 400, 3840, 
        3593, 3331, 3082, 2822, 2575, 2309, 2060, 1804, 1541, 1295, 1030, 778, 515, 265, 0 };

    std::vector<std::vector<int> > triangleTable = {
        /*0*/ {},
        /*1*/ {0, 3, 8, },
        /*2*/ {9, 1, 0, },
        /*3*/ {1, 3, 9, 3, 8, 9, },
        /*4*/ {2, 1, 10, },
        /*5*/ {0, 2, 8, 2, 11, 8, },
        /*6*/ {2, 0, 10, 0, 9, 10, },
        /*7*/ {3, 2, 8, 2, 8, 10, 8, 9, 10, },
        /*8*/ {3, 2, 11, },
        /*9*/ {0, 2, 8, 2, 11, 8, },
        /*10*/ {9, 10, 0, 10, 2, 0, },
        /*11*/ {2, 1, 11, 1, 11, 9, 11, 8, 9, },
        /*12*/ {3, 1, 11, 1, 10, 11, },
        /*13*/ {1, 0, 10, 0, 10, 8, 10, 11, 8, },
        /*14*/ {0, 3, 9, 3, 9, 11, 9, 10, 11, },
        /*15*/ {8, 9, 10, 8, 10, 11, },
        /*16*/ {8, 7, 4, },
        /*17*/ {3, 7, 0, 7, 4, 0, },
        /*18*/ {4, 0, 7, 0, 3, 7, },
        /*19*/ {9, 4, 1, 4, 1, 7, 1, 3, 7, },
        /*20*/ {3, 2, 11, 7, 4, 8, },
        /*21*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*22*/ {10, 5, 2, 5, 2, 4, 2, 0, 4, },
        /*23*/ {4, 9, 1, 4, 2, 1, 4, 2, 7, 2, 11, 7, },
        /*24*/ {3, 2, 11, 7, 4, 8, },
        /*25*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*26*/ {9, 10, 0, 10, 2, 0, 8, 7, 4, },
        /*27*/ {4, 7, 11, 4, 2, 11, 4, 2, 9, 2, 1, 9, },
        /*28*/ {3, 1, 11, 1, 10, 11, 7, 4, 8, },
        /*29*/ {3, 11, 10, 3, 10, 4, 3, 0, 4, 5, 10, 4, },
        /*30*/ {5, 4, 0, 5, 0, 11, 5, 10, 11, 3, 0, 11, },
        /*31*/ {7, 4, 11, 4, 11, 9, 11, 10, 9, },
        /*32*/ {4, 5, 9, },
        /*33*/ {5, 1, 4, 1, 0, 4, },
        /*34*/ {5, 1, 4, 1, 0, 4, },
        /*35*/ {4, 8, 5, 8, 5, 3, 5, 1, 3, },
        /*36*/ {9, 4, 5, 10, 2, 1, },
        /*37*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*38*/ {10, 5, 2, 5, 2, 4, 2, 0, 4, },
        /*39*/ {8, 3, 2, 8, 10, 2, 8, 10, 4, 10, 5, 4, },
        /*40*/ {9, 4, 5, 10, 2, 1, },
        /*41*/ {10, 5, 2, 5, 2, 4, 2, 0, 4, },
        /*42*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*43*/ {5, 10, 2, 5, 3, 2, 5, 3, 4, 3, 8, 4, },
        /*44*/ {10, 11, 1, 11, 3, 1, 9, 4, 5, },
        /*45*/ {3, 0, 4, 3, 4, 10, 3, 11, 10, 5, 4, 10, },
        /*46*/ {3, 0, 4, 3, 4, 10, 3, 11, 10, 5, 4, 10, },
        /*47*/ {4, 5, 8, 5, 8, 10, 8, 11, 10, },
        /*48*/ {7, 5, 8, 5, 9, 8, },
        /*49*/ {0, 9, 3, 9, 3, 5, 3, 7, 5, },
        /*50*/ {8, 0, 7, 0, 7, 1, 7, 5, 1, },
        /*51*/ {7, 3, 1, 7, 1, 5, },
        /*52*/ {7, 5, 8, 5, 9, 8, 3, 2, 11, },
        /*53*/ {11, 2, 0, 11, 0, 5, 11, 7, 5, 9, 0, 5, },
        /*54*/ {11, 7, 5, 11, 5, 0, 11, 2, 0, 9, 5, 0, },
        /*55*/ {10, 2, 5, 2, 5, 3, 5, 7, 3, },
        /*56*/ {7, 5, 8, 5, 9, 8, 3, 2, 11, },
        /*57*/ {9, 5, 7, 9, 7, 2, 9, 0, 2, 11, 7, 2, },
        /*58*/ {9, 0, 2, 9, 2, 7, 9, 5, 7, 11, 2, 7, },
        /*59*/ {10, 2, 5, 2, 5, 3, 5, 7, 3, },
        /*60*/ {8, 7, 9, 7, 9, 5, 3, 11, 1, 11, 1, 10, },
        /*61*/ {5, 7, 10, 7, 11, 10, 1, 0, 9, },
        /*62*/ {11, 10, 7, 10, 5, 7, 8, 0, 3, },
        /*63*/ {5, 7, 10, 7, 11, 10, },
        /*64*/ {10, 5, 6, },
        /*65*/ {5, 6, 10, 1, 0, 9, },
        /*66*/ {1, 0, 9, 5, 6, 10, },
        /*67*/ {1, 3, 9, 3, 8, 9, 5, 6, 10, },
        /*68*/ {1, 5, 2, 5, 6, 2, },
        /*69*/ {1, 5, 2, 5, 6, 2, 3, 8, 0, },
        /*70*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*71*/ {7, 6, 9, 7, 9, 2, 7, 6, 2, 1, 9, 2, },
        /*72*/ {6, 2, 5, 2, 1, 5, },
        /*73*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*74*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*75*/ {1, 9, 6, 1, 6, 6, 1, 2, 6, 7, 6, 6, },
        /*76*/ {11, 6, 3, 6, 3, 5, 3, 1, 5, },
        /*77*/ {6, 5, 9, 6, 0, 9, 6, 0, 11, 0, 3, 11, },
        /*78*/ {9, 5, 6, 9, 11, 6, 9, 11, 0, 11, 3, 0, },
        /*79*/ {5, 6, 9, 6, 9, 11, 9, 8, 11, },
        /*80*/ {10, 9, 6, 9, 4, 6, },
        /*81*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*82*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*83*/ {8, 4, 6, 8, 6, 1, 8, 3, 1, 10, 6, 1, },
        /*84*/ {6, 2, 5, 2, 1, 5, 4, 8, 7, },
        /*85*/ {0, 3, 4, 3, 4, 7, 1, 2, 5, 2, 5, 6, },
        /*86*/ {0, 2, 6, 0, 6, 4, },
        /*87*/ {3, 6, 2, 6, 2, 4, 2, 6, 4, },
        /*88*/ {3, 6, 2, 6, 2, 4, 2, 6, 4, },
        /*89*/ {0, 2, 6, 0, 6, 4, },
        /*90*/ {6, 7, 2, 7, 2, 3, 5, 4, 1, 4, 1, 0, },
        /*91*/ {3, 8, 2, 8, 2, 4, 2, 6, 4, },
        /*92*/ {10, 6, 4, 10, 4, 3, 10, 1, 3, 6, 4, 3, },
        /*93*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*94*/ {5, 1, 4, 1, 0, 4, 7, 11, 6, },
        /*95*/ {6, 4, 11, 4, 8, 11, },
        /*96*/ {4, 6, 9, 6, 10, 9, },
        /*97*/ {11, 3, 6, 3, 6, 0, 6, 4, 0, },
        /*98*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*99*/ {8, 3, 1, 8, 1, 6, 8, 4, 6, 10, 1, 6, },
        /*100*/ {9, 1, 4, 1, 4, 2, 4, 6, 2, },
        /*101*/ {6, 4, 0, 6, 0, 2, },
        /*102*/ {4, 0, 2, 4, 2, 6, },
        /*103*/ {9, 1, 4, 1, 4, 2, 4, 6, 2, },
        /*104*/ {9, 1, 4, 1, 4, 2, 4, 6, 2, },
        /*105*/ {2, 6, 4, 2, 4, 0, },
        /*106*/ {6, 4, 0, 6, 0, 2, },
        /*107*/ {3, 8, 2, 8, 2, 4, 2, 6, 4, },
        /*108*/ {10, 1, 3, 10, 3, 4, 10, 6, 4, 6, 3, 4, },
        /*109*/ {11, 3, 6, 3, 6, 0, 6, 4, 0, },
        /*110*/ {11, 3, 6, 3, 6, 0, 6, 4, 0, },
        /*111*/ {6, 4, 11, 4, 8, 11, },
        /*112*/ {6, 7, 10, 7, 10, 8, 10, 9, 8, },
        /*113*/ {10, 1, 0, 10, 8, 0, 10, 8, 6, 8, 7, 6, },
        /*114*/ {0, 1, 10, 0, 6, 10, 0, 6, 8, 6, 7, 8, },
        /*115*/ {6, 10, 7, 10, 7, 1, 7, 3, 1, },
        /*116*/ {7, 6, 2, 7, 2, 9, 7, 8, 9, 1, 2, 9, },
        /*117*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*118*/ {8, 7, 0, 7, 0, 6, 0, 2, 6, },
        /*119*/ {2, 6, 3, 6, 7, 3, },
        /*120*/ {7, 8, 9, 7, 9, 2, 7, 6, 2, 1, 9, 2, },
        /*121*/ {8, 7, 0, 7, 0, 6, 0, 2, 6, },
        /*122*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*123*/ {2, 6, 3, 6, 7, 3, },
        /*124*/ {8, 9, 3, 9, 1, 3, 11, 6, 7, },
        /*125*/ {8, 0, 3, 11, 6, 7, },
        /*126*/ {11, 6, 7, 8, 0, 3, },
        /*127*/ {11, 6, 7, },
        /*128*/ {11, 6, 7, },
        /*129*/ {11, 6, 7, 8, 0, 3, },
        /*130*/ {8, 0, 3, 11, 6, 7, },
        /*131*/ {8, 9, 3, 9, 1, 3, 11, 6, 7, },
        /*132*/ {2, 6, 3, 6, 7, 3, },
        /*133*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*134*/ {8, 7, 0, 7, 0, 6, 0, 2, 6, },
        /*135*/ {7, 8, 9, 7, 9, 2, 7, 6, 2, 1, 9, 2, },
        /*136*/ {2, 6, 3, 6, 7, 3, },
        /*137*/ {8, 7, 0, 7, 0, 6, 0, 2, 6, },
        /*138*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*139*/ {7, 6, 2, 7, 2, 9, 7, 8, 9, 1, 2, 9, },
        /*140*/ {6, 10, 7, 10, 7, 1, 7, 3, 1, },
        /*141*/ {0, 1, 10, 0, 6, 10, 0, 6, 8, 6, 7, 8, },
        /*142*/ {10, 1, 0, 10, 8, 0, 10, 8, 6, 8, 7, 6, },
        /*143*/ {6, 7, 10, 7, 10, 8, 10, 9, 8, },
        /*144*/ {6, 4, 11, 4, 8, 11, },
        /*145*/ {11, 3, 6, 3, 6, 0, 6, 4, 0, },
        /*146*/ {11, 3, 6, 3, 6, 0, 6, 4, 0, },
        /*147*/ {10, 1, 3, 10, 3, 4, 10, 6, 4, 6, 3, 4, },
        /*148*/ {3, 8, 2, 8, 2, 4, 2, 6, 4, },
        /*149*/ {6, 4, 0, 6, 0, 2, },
        /*150*/ {2, 6, 4, 2, 4, 0, },
        /*151*/ {9, 1, 4, 1, 4, 2, 4, 6, 2, },
        /*152*/ {9, 1, 4, 1, 4, 2, 4, 6, 2, },
        /*153*/ {4, 0, 2, 4, 2, 6, },
        /*154*/ {6, 4, 0, 6, 0, 2, },
        /*155*/ {9, 1, 4, 1, 4, 2, 4, 6, 2, },
        /*156*/ {8, 3, 1, 8, 1, 6, 8, 4, 6, 10, 1, 6, },
        /*157*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*158*/ {11, 3, 6, 3, 6, 0, 6, 4, 0, },
        /*159*/ {4, 6, 9, 6, 10, 9, },
        /*160*/ {6, 4, 11, 4, 8, 11, },
        /*161*/ {5, 1, 4, 1, 0, 4, 7, 11, 6, },
        /*162*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*163*/ {10, 6, 4, 10, 4, 3, 10, 1, 3, 6, 4, 3, },
        /*164*/ {3, 8, 2, 8, 2, 4, 2, 6, 4, },
        /*165*/ {6, 7, 2, 7, 2, 3, 5, 4, 1, 4, 1, 0, },
        /*166*/ {0, 2, 6, 0, 6, 4, },
        /*167*/ {3, 6, 2, 6, 2, 4, 2, 6, 4, },
        /*168*/ {3, 6, 2, 6, 2, 4, 2, 6, 4, },
        /*169*/ {0, 2, 6, 0, 6, 4, },
        /*170*/ {0, 3, 4, 3, 4, 7, 1, 2, 5, 2, 5, 6, },
        /*171*/ {6, 2, 5, 2, 1, 5, 4, 8, 7, },
        /*172*/ {8, 4, 6, 8, 6, 1, 8, 3, 1, 10, 6, 1, },
        /*173*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*174*/ {1, 10, 0, 10, 0, 6, 0, 4, 6, },
        /*175*/ {10, 9, 6, 9, 4, 6, },
        /*176*/ {5, 6, 9, 6, 9, 11, 9, 8, 11, },
        /*177*/ {9, 5, 6, 9, 11, 6, 9, 11, 0, 11, 3, 0, },
        /*178*/ {6, 5, 9, 6, 0, 9, 6, 0, 11, 0, 3, 11, },
        /*179*/ {11, 6, 3, 6, 3, 5, 3, 1, 5, },
        /*180*/ {1, 9, 6, 1, 6, 6, 1, 2, 6, 7, 6, 6, },
        /*181*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*182*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*183*/ {6, 2, 5, 2, 1, 5, },
        /*184*/ {7, 6, 9, 7, 9, 2, 7, 6, 2, 1, 9, 2, },
        /*185*/ {5, 9, 6, 9, 6, 0, 6, 2, 0, },
        /*186*/ {1, 5, 2, 5, 6, 2, 3, 8, 0, },
        /*187*/ {1, 5, 2, 5, 6, 2, },
        /*188*/ {1, 3, 9, 3, 8, 9, 5, 6, 10, },
        /*189*/ {1, 0, 9, 5, 6, 10, },
        /*190*/ {5, 6, 10, 1, 0, 9, },
        /*191*/ {10, 5, 6, },
        /*192*/ {5, 7, 10, 7, 11, 10, },
        /*193*/ {11, 10, 7, 10, 5, 7, 8, 0, 3, },
        /*194*/ {5, 7, 10, 7, 11, 10, 1, 0, 9, },
        /*195*/ {8, 7, 9, 7, 9, 5, 3, 11, 1, 11, 1, 10, },
        /*196*/ {10, 2, 5, 2, 5, 3, 5, 7, 3, },
        /*197*/ {9, 0, 2, 9, 2, 7, 9, 5, 7, 11, 2, 7, },
        /*198*/ {9, 5, 7, 9, 7, 2, 9, 0, 2, 11, 7, 2, },
        /*199*/ {7, 5, 8, 5, 9, 8, 3, 2, 11, },
        /*200*/ {10, 2, 5, 2, 5, 3, 5, 7, 3, },
        /*201*/ {11, 7, 5, 11, 5, 0, 11, 2, 0, 9, 5, 0, },
        /*202*/ {11, 2, 0, 11, 0, 5, 11, 7, 5, 9, 0, 5, },
        /*203*/ {7, 5, 8, 5, 9, 8, 3, 2, 11, },
        /*204*/ {7, 3, 1, 7, 1, 5, },
        /*205*/ {8, 0, 7, 0, 7, 1, 7, 5, 1, },
        /*206*/ {0, 9, 3, 9, 3, 5, 3, 7, 5, },
        /*207*/ {7, 5, 8, 5, 9, 8, },
        /*208*/ {4, 5, 8, 5, 8, 10, 8, 11, 10, },
        /*209*/ {3, 0, 4, 3, 4, 10, 3, 11, 10, 5, 4, 10, },
        /*210*/ {3, 0, 4, 3, 4, 10, 3, 11, 10, 5, 4, 10, },
        /*211*/ {10, 11, 1, 11, 3, 1, 9, 4, 5, },
        /*212*/ {5, 10, 2, 5, 3, 2, 5, 3, 4, 3, 8, 4, },
        /*213*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*214*/ {10, 5, 2, 5, 2, 4, 2, 0, 4, },
        /*215*/ {9, 4, 5, 10, 2, 1, },
        /*216*/ {8, 3, 2, 8, 10, 2, 8, 10, 4, 10, 5, 4, },
        /*217*/ {10, 5, 2, 5, 2, 4, 2, 0, 4, },
        /*218*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*219*/ {9, 4, 5, 10, 2, 1, },
        /*220*/ {4, 8, 5, 8, 5, 3, 5, 1, 3, },
        /*221*/ {5, 1, 4, 1, 0, 4, },
        /*222*/ {5, 1, 4, 1, 0, 4, },
        /*223*/ {4, 5, 9, },
        /*224*/ {7, 4, 11, 4, 11, 9, 11, 10, 9, },
        /*225*/ {5, 4, 0, 5, 0, 11, 5, 10, 11, 3, 0, 11, },
        /*226*/ {3, 11, 10, 3, 10, 4, 3, 0, 4, 5, 10, 4, },
        /*227*/ {3, 1, 11, 1, 10, 11, 7, 4, 8, },
        /*228*/ {4, 7, 11, 4, 2, 11, 4, 2, 9, 2, 1, 9, },
        /*229*/ {9, 10, 0, 10, 2, 0, 8, 7, 4, },
        /*230*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*231*/ {3, 2, 11, 7, 4, 8, },
        /*232*/ {4, 9, 1, 4, 2, 1, 4, 2, 7, 2, 11, 7, },
        /*233*/ {10, 5, 2, 5, 2, 4, 2, 0, 4, },
        /*234*/ {7, 11, 4, 11, 4, 2, 4, 0, 2, },
        /*235*/ {3, 2, 11, 7, 4, 8, },
        /*236*/ {9, 4, 1, 4, 1, 7, 1, 3, 7, },
        /*237*/ {4, 0, 7, 0, 3, 7, },
        /*238*/ {3, 7, 0, 7, 4, 0, },
        /*239*/ {8, 7, 4, },
        /*240*/ {8, 9, 10, 8, 10, 11, },
        /*241*/ {0, 3, 9, 3, 9, 11, 9, 10, 11, },
        /*242*/ {1, 0, 10, 0, 10, 8, 10, 11, 8, },
        /*243*/ {3, 1, 11, 1, 10, 11, },
        /*244*/ {2, 1, 11, 1, 11, 9, 11, 8, 9, },
        /*245*/ {9, 10, 0, 10, 2, 0, },
        /*246*/ {0, 2, 8, 2, 11, 8, },
        /*247*/ {3, 2, 11, },
        /*248*/ {3, 2, 8, 2, 8, 10, 8, 9, 10, },
        /*249*/ {2, 0, 10, 0, 9, 10, },
        /*250*/ {0, 2, 8, 2, 11, 8, },
        /*251*/ {2, 1, 10, },
        /*252*/ {1, 3, 9, 3, 8, 9, },
        /*253*/ {9, 1, 0, },
        /*254*/ {0, 3, 8, },
        /*255*/ {},
        };
};